<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="text/babel">
// this is the dynamitab.js class file..

// this is a class definition for a Tab. Tabs can be added to TabView objects.
class Tab {
  constructor(tabview, id, title, selected=false, description=undefined) {
    this._id = id;
    this.title = title;
    this.selected = selected;
    this.description = description;
    
    this.class_prefix = tabview.class_prefix;
    this._tabview_id = tabview.id;
    this.panel_heading_level = tabview.panel_heading_level;
    this.tab_id = tabview.id + "-tab" + id;
    this.tab_class = tabview.class_prefix + "-tab";
    this.panel_id = tabview.id + "-panel" + id;
    this.panel_class = tabview.class_prefix + "-panel";
  }
  
  get id() {
    return this._id;
  }
  set id(value) {
    this._id = value;
    this.tab_id = this.tabview_id + "-tab" + value;
    this.panel_id = this.tabview_id + "-panel" + value;
  }
  
  get tabview_id() {
    return this._tabview_id;
  }
  set tabview_id(value) {
    this._tabview_id = value;
    this.tab_id = value + "-tab" + this.id;
    this.tab_class = value + "-tab";
    this.panel_id = value + "-panel" + this.id;
    this.panel_class = value + "-panel";
  }
  
  get tab_element() {
    var tabobj = document.createElement("li");
    tabobj.setAttribute("role", "tab");
    tabobj.setAttribute("id", this.tab_id);
    tabobj.setAttribute("class", this.tab_class);
    tabobj.setAttribute("tabindex", "0");
    tabobj.setAttribute("aria-selected", this.selected.toString());
    tabobj.setAttribute("aria-controls", this.panel_id);
    if(this.description != undefined) {
      tabobj.setAttribute("title", this.description);
    }
    tabobj.textContent = this.title;
    return tabobj;
  }
  
  get panel_element() {
    var panelobj = document.createElement("section");
    panelobj.setAttribute("id", this.panel_id);
    panelobj.setAttribute("class", this.panel_class);
    var panel_hidden = !this.selected;
    panel_hidden = panel_hidden.toString();
    panelobj.setAttribute("aria-hidden", panel_hidden);
    panelobj.setAttribute("aria-labelledby", this.tab_id);
    panelobj.setAttribute("role", "tabpanel");
    var panelheading = document.createElement("h" + this.panel_heading_level);
    panelheading.textContent = this.title;
    panelobj.appendChild(panelheading);
    return panelobj;
  }
}

// this is the class definition for TabView objects (the main object used when constructing a TabView).
class TabView {
  constructor(id, class_prefix=undefined, default_tab=1, expand_tabs=true, panel_heading_level=2) {
    this._id = id;
    if(class_prefix === undefined) {
      this.class_prefix = id;
    } else {
      this.class_prefix = class_prefix;
    }
    this.panel_heading_level = panel_heading_level;
    this.tabs = Array();
    this.expand_tabs = expand_tabs;
    this.default_tab = default_tab;
    
    this.tablist_id = id + "-tablist";
    this.tablist_class = this.class_prefix + "-tablist";
  }
  
  get id() {
    return this._id;
  }
  set id(value) {
    this._id = value;
    if(this.tabs.length != 0) {
      for(var i = 0; i < this.tabs.length; i++) {
        this.tabs[i].tabview_id = value;
      }
    }
  }
   
  get tablist() {
    var tablist = document.createElement("ul");
    tablist.setAttribute("role", "tablist");
   tablist.setAttribute("id", this.tablist_id);
    tablist.setAttribute("class", this.tablist_class);
    for(var i = 0; i < this.tabs.length; i++) {
      var child = this.tabs[i].tab_element;
      if(this.expand_tabs) {
        child.style.width = "calc(100% / " + this.tabs.length + ")";
      }
      tablist.appendChild(child);
    }
    return tablist
  }
  
  get tabview() {
    var tabview = document.createElement("section");
    tabview.setAttribute("id", this.id);
    tabview.appendChild(this.tablist);
    for(var i = 0; i < this.tabs.length; i++) {
      tabview.appendChild(this.tabs[i].panel_element);
    }
    return tabview;
  }
}
</script>
